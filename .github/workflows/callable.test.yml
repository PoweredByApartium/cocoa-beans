name: Run tests

on:
    workflow_call:
        
permissions:
    contents: read
    packages: write
    id-token: write
    pages: write

jobs:
    run_tests:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
        - uses: actions/setup-java@v3
          with:
            java-version: '17'
            distribution: 'adopt'
        - name: Setup Gradle
          uses: gradle/actions/setup-gradle@v3
        - name: Run integration tests
          run: ./gradlew test
        - name: Publish Test Report
          uses: mikepenz/action-junit-report@v4
          if: success() || failure()
          with:
           token: ${{ secrets.GITHUB_TOKEN }} 
           detailed_summary: true
           follow_symlink: true
           check_name: |
                commands
                common
                spigot
           report_paths: |
                **/commands/build/test-results/test/TEST-*.xml
                **/common/build/test-results/test/TEST-*.xml
                **/spigot/build/test-results/test/TEST-*.xml